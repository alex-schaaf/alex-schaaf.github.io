<!doctype html>
<html lang="en">

<head>
  <title>A simple example of Python decorators: Logging function in- and outputs</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/style.css">

</head>

<body>
  <div class="container">
    <header>
      <div>
        <div class="page-title">
          <a href="/">Alexander Schaaf</a>
        </div>
        <div class="page-subtitle">developer</div>
      </div>
      <div>
        <nav></nav>
      </div>
    </header>
    <main>
      <div class="content"><div class="post">
  <div>
    <h1 class="title">
      A simple example of Python decorators: Logging function in- and outputs
    </h1>
    <span class="date">July 4, 2021</span>
  </div>
  <div>
    <p>Decorators in Python were an advanced mystery to me when I first started out coding. I stayed away from them longer than was necessary, feeling like it was too advanced for me. Turns out decorators are nothing but syntactic sugar to call a higher-order functions on the decorated function. A higher-order function is roughly defined as a function that takes at least one other function as an argument, which returns a function, or both.</p>
<p>So let’s explore this abstract concept with an example I find really helpful: logging the arguments of a function. One way is to modify the function a function directly to log its input. But this is pretty cumbersome to do and potentially requires us to modify a lot of functions. Another way is to write a decorator for it!</p>
<p>Let’s start with a simple function we want to log:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span><br>    <span class="token keyword">return</span> a <span class="token operator">+</span> b</code></pre>
<p>To define a decorator we define a function that takes the decorated function as its first argument:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Callable<br><br><span class="token keyword">def</span> <span class="token function">logging_decorator</span><span class="token punctuation">(</span>decorated_function<span class="token punctuation">:</span> Callable<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">pass</span></code></pre>
<p>We then define a wrapper function inside our decorator that does the logging. Our wrapper function takes a generic list of arguments <code>args</code> and a dictionary of keyword arguments <code>kwargs</code>. Those, we print out (our logging) and then return our <code>decorated_function</code> results by calling it with the given <code>args</code> and <code>kwargs</code>:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">logging_decorator</span><span class="token punctuation">(</span>decorated_function<span class="token punctuation">:</span> Callable<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">wrapper_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"arguments: </span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"keyword arguments: </span><span class="token interpolation"><span class="token punctuation">{</span>kwargs<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> decorated_function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> wrapper_function</code></pre>
<p>And that’s it. We can now decorate our <code>sum</code> function with the logging decorator and run it:</p>
<pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@logging_decorator</span><br><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span><br>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<br><br><br><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span><br>    <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></code></pre>
<p>Which produces the following output:</p>
<pre class="language-text"><code class="language-text">arguments: (42, 10)<br>keyword arguments: {}</code></pre>
<p>What we end up doing here is that we actually don’t directly call the <code>sum</code> function, but rather we call the <code>logging_decorator</code> function with our <code>sum</code> function as its input argument <code>decorated_function</code>. Calling the <code>logging_decorator</code> function will now return our <code>wrapper_function</code>, which will run our print statements and our decorated <code>sum</code> function.</p>
<h2 id="improving-the-logging-output">Improving the logging output <a class="direct-link" href="#improving-the-logging-output">#</a></h2>
<p>To make our logging decorator more useful we can add some bells and whistles to it. For example printing the name of the called function:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">logging_decorator</span><span class="token punctuation">(</span>decorated_function<span class="token punctuation">:</span> Callable<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">wrapper_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"function: </span><span class="token interpolation"><span class="token punctuation">{</span>decorated_function<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"arguments: </span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"keyword arguments: </span><span class="token interpolation"><span class="token punctuation">{</span>kwargs<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> decorated_function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> wrapper_function</code></pre>
<p>Producing the output:</p>
<pre class="language-text"><code class="language-text">function: sum<br>arguments: (42, 10)<br>keyword arguments: {}</code></pre>
<p>Or make it print out the function statement with all arguments:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">logging_decorator</span><span class="token punctuation">(</span>decorated_function<span class="token punctuation">:</span> Callable<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">wrapper_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        name <span class="token operator">=</span> decorated_function<span class="token punctuation">.</span>__name__<br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token keyword">for</span> arg <span class="token keyword">in</span> args<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> decorated_function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> wrapper_function</code></pre>
<p>Producing the output:</p>
<pre class="language-text"><code class="language-text">sum(42, 10)</code></pre>
<p>We can expand on this to also print out the keyword arguments of the decorated function and its return value. For that we actually run the <code>decorated_function</code> inside our wrapper function and return the resulting value:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">logging_decorator</span><span class="token punctuation">(</span>decorated_function<span class="token punctuation">:</span> Callable<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Callable<span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">wrapper_function</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        name <span class="token operator">=</span> decorated_function<span class="token punctuation">.</span>__name__<br>        arguments <span class="token operator">=</span> <span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token keyword">for</span> arg <span class="token keyword">in</span> args<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        keyword_arguments <span class="token operator">=</span> <span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">{</span>v<span class="token punctuation">}</span></span><span class="token string">'</span></span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        results <span class="token operator">=</span> decorated_function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">{</span>arguments<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>keyword_arguments<span class="token punctuation">}</span></span><span class="token string">) -> </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> results<br>    <span class="token keyword">return</span> wrapper_function</code></pre>
<p>To demonstrate I’ve added a keyword argument to the <code>sum</code> function for an optional third summation parameter:</p>
<pre class="language-python"><code class="language-python"><span class="token decorator annotation punctuation">@logging_decorator</span><br><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span><br>    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<br><br><br><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span><br>    <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span><br>    <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><br>    <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>
<p>Which will give us the following output:</p>
<pre class="language-text"><code class="language-text">sum(42, 10, c=9) -> 61<br>sum(0, 5, c=-4) -> 1<br>sum(9, 1, ) -> 10</code></pre>
<p>There’s still a lot of room to improve on this, for example to actually use a <code>logger</code> to log rather than just printing to the standard output. Another improvement would be to also log the types of the (keyword) arguments.</p>
<p>I hope this example of a logging decorator helped your understanding of how Python decorators work.</p>

  </div>
</div></div>
    </main>
    <footer style="min-height: 4em;"></footer>
  </div>
</body>

</html>